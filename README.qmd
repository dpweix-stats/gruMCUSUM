---
title: "README"
format: gfm
---

## Set Up

The repository is meant as an accompaniment to the paper *Monitoring Covariance in Multivariate Time Series: Comparing Machine Learning and Statistical Approaches*.

First install the `mlmcusum` package from https://github.com/dpweix/mlmcusum.git. The gated recurrent unit (GRU) is run using the Tensorflow software in python. This code can be found in the downloaded `R` package at `mlmcusum/inst/python/gru_functions.py`. Whenever the `path_py` variable is included in a file, it is important that the absolute file path is provided. Otherwise the python code cannot be found by the package.

Once the path is determined use `source_python` from the `reticulate` package to load in all required python functions for the `mlmcusum` package.

Additionally, these files make use of `here` package to avoid needed absolute pathing for file locations. In order for the `here` package to work, please open this repository as an R project. Alternatively, absolute pathing may be added to each file for a specific user.

```{r}

library("reticulate")
# Custom package https://github.com/dpweix/mlmcusum.git
library("mlmcusum")

# Load GRU functions
path_py <- "~/git/mlmcusum/inst/python/gru_functions.py"
source_python(path_py)

```

## File Descriptions

+------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| File name                    | Description                                                                                                                                                                                                                                    |
+==============================+================================================================================================================================================================================================================================================+
| 1-case-study-data.R          | Read/clean data from the case study. Save data as .rds files and creates the breaks of training data (model), training data (estimate *h*), and testing data.                                                                                  |
+------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 2-case-study-apply-methods.R | Fit models and apply methods on the data cleaned in file 1. Saves the resulting model predictions, plotting statistics, and control limits.                                                                                                    |
+------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 3-case-study-figures.R       | Create all figures used in the paper. Dependent on having run files 1 and 2.                                                                                                                                                                   |
+------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 4-broken-methods.R           | Contains the function `gen_sim_study_brk`. This function runs the entire simulation study based on a choice of data structure. The return values for this function are plotting statistic, run length, and control limit for each method type. |
+------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 5-arl-study.R                | This file imports `gen_sim_study_brk` and runs a single simulation with the chosen settings (usually imported from file 6). Then the resulting run length and control limit are saved in a .rds file in the results folder.                    |
+------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 6-sim-study.R                | This file is used to run the simulation study (neither file 4 or 5 need to be run). All simulation settings are chosen and file 5 is repeatedly submitted as an Rstudio background job to encourage parallel running of the simulations.\      |
|                              | \                                                                                                                                                                                                                                              |
|                              | Once all files are saved for each data generation structure the ARL tables can be loaded in as data frames, and converted to LaTeX tables.                                                                                                     |
+------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 7-visualize-study.R          | This file provides time series plots for all the different data generation structures and their respective faults.                                                                                                                             |
+------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

: Description of files used to recreate results in paper.

## How to use this repository

This repository can be used to recreate the results in the paper, or as a general guide for how to use the `mlmcusum` package. This package is meant for use in fault detection on the covariance of multivariate time series data, particularly data with non-linear relationships between variables.
